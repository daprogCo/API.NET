name: SSH Debug to VPS

on:
  push:
    branches:
      - master

jobs:
  ssh-debug:
    name: SSH Connection Debug
    runs-on: ubuntu-latest

    steps:
      - name: Set up SSH key
        run: |
          mkdir -p ~/.ssh
          echo "${{ secrets.VPS_SSH_KEY }}" > ~/.ssh/id_rsa
          chmod 600 ~/.ssh/id_rsa
          ssh-keyscan -H $(echo "${{ secrets.VPS_HOST }}" | cut -d@ -f2) >> ~/.ssh/known_hosts

      - name: Test DNS resolution and ping
        run: |
          echo "🔍 Testing DNS resolution..."
          ping -c 3 $(echo "${{ secrets.VPS_HOST }}" | cut -d@ -f2) || echo "⚠️ Ping failed (may be firewalled)."

      - name: Manual SSH debug
        run: |
          echo "🚀 Attempting SSH connection with verbose output..."
          ssh -v -o StrictHostKeyChecking=yes ${{ secrets.VPS_HOST }} "echo '✅ Connected to VPS'"
